{% extends 'base.html' %}
{%load static%}


{% block title %}이미지 생성{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        <h2>이미지 생성 (로그인 필요)</h2>
        <p class="text-muted">모델: Stable Diffusion 2.1 (HF API)</p>
        
        <form method="post" onsubmit="startLoading(this)">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit" class="btn btn-primary" id = "submit-btn">생성</button>
            <div id="loading" style="display:none;">
            <h5>로딩중.. 잠시만 기다려주세요</h5>
            </div>
        </form>

        {% if error %}
            <div class="alert alert-danger mt-3">{{ error }}</div>
        {% endif %}

        {% if result %}

            <div class="alert alert-success mt-3">
                <h5>생성 결과:</h5>
                <img src="{{ result }}" alt="Generated Image" class="img-fluid" style="max-width: 100%; height: auto;">
            </div>
        {% endif %}
    </div>

    <div class="col-md-4">
        <div class="history-section">
            <h5>최근 히스토리</h5>
            
            {% if history %}
                {% for item in history|slice:":5" %}
                    <div class="history-item">
                        <strong>프롬프트:</strong> {{ item.user_input|truncatewords:8 }}<br>
                        <img src="{{ item.model_output }}" alt="History Image" style="max-width: 100px; height: auto;">
                        <br><small class="text-muted">{{ item.created_at }}</small>
                    </div>
                {% endfor %}
            {% else %}
                <p class="text-muted">히스토리가 없습니다.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
{%block extra_js%}
<script>
function startLoading(form) {
    document.getElementById("loading").style.display = "block";
    document.getElementById("submit-btn").disabled = true;
}
</script>
{%endblock%}