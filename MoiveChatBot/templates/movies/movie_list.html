{% extends "base.html" %}
{% load static %}

{% block title %}영화 목록{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/movie_list.css' %}">
{% endblock %}

{% block content %}
<h2>영화 목록</h2>

<form method="get">
  <input type="text" name="search" value="{{ search_query }}" placeholder="검색(제목/감독/배우)">
  <select name="filter">
    <option value="all" {% if filter_type == 'all' %}selected{% endif %}>전체</option>
    <option value="tmdb" {% if filter_type == 'tmdb' %}selected{% endif %}>TMDB</option>
    <option value="user" {% if filter_type == 'user' %}selected{% endif %}>직접추가</option>
  </select>
  <select name="sort">
    <option value="latest" {% if sort_by == 'latest' %}selected{% endif %}>최신순</option>
    <option value="title" {% if sort_by == 'title' %}selected{% endif %}>제목순</option>
    <option value="rating" {% if sort_by == 'rating' %}selected{% endif %}>별점순</option>
    <option value="year" {% if sort_by == 'year' %}selected{% endif %}>개봉년도순</option>
  </select>
  <button type="submit">적용</button>
</form>

<p>
  전체: {{ total_count }} /
  TMDB: {{ tmdb_count }} /
  직접추가: {{ user_count }}
</p>

<div class="movie_container">
  <ul class="movie_list">
    {% for movie in movies %}
      <li class="movie-item">
          <a href="{% url 'movie_detail' movie.pk %}">
        <div>
            <img src="{{ movie.get_poster_display }}" alt="{{ movie.title }}" class="poster-img">
        </div>
        <div class="title">
          {{ movie.title }}</a>
        </div>

        <div class="meta">
          ({{ movie.release_year }}) <br>
          {{ movie.genre }} <br>
          {{ movie.get_star_rating }}
        </div>

          <div class="actions">
            <a href="{% url 'movie_update' movie.pk %}">수정</a>
            <a href="{% url 'movie_delete' movie.pk %}">삭제</a>
          </div>

      </li>
    {% empty %}
      <li>영화가 없습니다.</li>
    {% endfor %}
  </ul>
</div>

<div>
  {% if movies.has_previous %}
    <a href="?page={{ movies.previous_page_number }}&search={{ search_query }}&filter={{ filter_type }}&sort={{ sort_by }}">이전</a>
  {% endif %}

  <span>{{ movies.number }} / {{ movies.paginator.num_pages }}</span>

  {% if movies.has_next %}
    <a href="?page={{ movies.next_page_number }}&search={{ search_query }}&filter={{ filter_type }}&sort={{ sort_by }}">다음</a>
  {% endif %}
</div>
{% endblock %}
