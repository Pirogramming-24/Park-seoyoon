{% extends "base.html" %}
{% block title %}Search | Pirostagram{% endblock %}

{% block content %}


  <div class="container-feed">
    <form class="search" action="{% url 'accounts:search' %}" method="get">
      <input name="q" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”" value="{{ q|default:'' }}" />
      <button type="submit" class="search-btn">ê²€ìƒ‰</button>
    </form>
    {% if q %}
      <div class="search-head">
        <div class="search-query">ê²€ìƒ‰: <b>{{ q }}</b></div>

        <!-- ì •ë ¬ ì˜µì…˜ì€ ê²Œì‹œê¸€ íƒ­ì¼ ë•Œë§Œ ë…¸ì¶œ -->
        {% if tab == "posts" %}
          <div class="search-sort">
            <a href="{% url 'accounts:search' %}?q={{ q }}&tab=posts&sort=new"
               class="{% if sort == 'new' %}active{% endif %}">ìµœì‹ ìˆœ</a>
            <a href="{% url 'accounts:search' %}?q={{ q }}&tab=posts&sort=likes"
               class="{% if sort == 'likes' %}active{% endif %}">ì¢‹ì•„ìš”ìˆœ</a>
            <a href="{% url 'accounts:search' %}?q={{ q }}&tab=posts&sort=comments"
               class="{% if sort == 'comments' %}active{% endif %}">ëŒ“ê¸€ìˆœ</a>
          </div>
        {% endif %}
      </div>

      <div class="search-tabs">
        <a href="{% url 'accounts:search' %}?q={{ q }}&tab=posts&sort={{ sort }}"
           class="{% if tab == 'posts' %}active{% endif %}">ê²Œì‹œê¸€</a>
        <a href="{% url 'accounts:search' %}?q={{ q }}&tab=users"
           class="{% if tab == 'users' %}active{% endif %}">ìœ ì €</a>
      </div>

      {% if tab == "users" %}
        <div class="user-search-results">
          {% for u in users %}
            <div class="user-row">
              <div>
                <b>{{ u.username }}</b>
                {% if u.first_name or u.last_name %}
                  <span class="muted">{{ u.last_name }}{{ u.first_name }}</span>
                {% endif %}
              </div>
              <a class="btn" href="{% url 'accounts:profile' u.username %}">í”„ë¡œí•„</a>
            </div>
          {% empty %}
            <p class="muted">ìœ ì € ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ì–´ìš”.</p>
          {% endfor %}
        </div>

      {% else %}
        <div class="feed">
          {% for post in posts %}
            {# âœ… ë„ˆ ê¸°ì¡´ feedì˜ post ì¹´ë“œ ë¸”ë¡ì„ ê·¸ëŒ€ë¡œ ì—¬ê¸° ë³µë¶™í•˜ë©´ ë¨ #}
            <div class="post-card">
              <div><b>{{ post.author.username }}</b></div>
              {% if post.image %}<img src="{{ post.image.url }}" style="width:100%;border-radius:12px;margin-top:8px;">{% endif %}
              <div style="margin-top:8px;">{{ post.content }}</div>
              <div class="muted" style="margin-top:6px;">
                â¤ {{ post.like_count }} Â· ğŸ’¬ {{ post.comment_count }}
              </div>
            </div>
          {% empty %}
            <p class="muted">ê²Œì‹œê¸€ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ì–´ìš”.</p>
          {% endfor %}
        </div>
      {% endif %}

    {% endif %}
  </div>
{% endblock %}
