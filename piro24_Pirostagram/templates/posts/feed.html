{% extends "base.html" %}
{% block title %}Feed | Pirostagram{% endblock %}

{% block content %}

<div class="container-feed">


<div class="story-bar">
    <div class="story-list">
  {% if user.is_authenticated %}
    <a class="story-btn" href="{% url 'stories:create' %}">
        <img src="/static/images/story.jpg" alt="">
    </a>
  {% endif %}

    {% for s in stories %}
      <a class="story-circle" href="{% url 'stories:view' s.id %}">
        <div class="circle">{{ s.author.username|slice:":1"|upper }}</div>
        <div class="name">{{ s.author.username }}</div>
      </a>
    {% empty %}
      <div class="hint">í™œì„± ìŠ¤í† ë¦¬ê°€ ì—†ì–´ìš”.</div>
    {% endfor %}
  </div>
</div>



    <div class="feed">
        {% for post in posts %}
            <article class="card">
                <div class="card-header"> <!--ê²Œì‹œì ì •ë³´ -->
                    <div class="username">{{ post.author.username }}</div>

                    <div class="header-right">
                        <div class="meta">{{ post.created_at|date:"Y-m-d H:i" }}</div>

                        {% if user.is_authenticated and post.author_id == user.id %}
                            <div class="post-menu">
                            <a class="link" href="{% url 'posts:update' post.id %}">ìˆ˜ì •</a>
                            <a class="link danger" href="{% url 'posts:delete' post.id %}">ì‚­ì œ</a>
                            </div>
                        {% endif %}
                    </div>
                </div>

                <div class="card-image"><img src="{{ post.image.url }}" alt="post image"></div>

                <div class="card-body"> <!--ê²Œì‹œë¬¼ì˜ ë‚´ìš©(ì´ë¯¸ì§€, ê¸€, ëŒ“ê¸€ ë“±)-->
                {% if post.content %}
                    <p class="content">{{ post.content }}</p>
                {% endif %}

                <div class="counts"> <!--í•˜ë‹¨ì˜ì—­-->
                    <span class="like-count" data-post-id="{{ post.id }}">
                        ì¢‹ì•„ìš” <b>{{ post.like_count }}</b></span>
                    <span>ëŒ“ê¸€ {{ post.comment_count }}</span>
                    <div class="comments">
                        <div class="comment-list">
                            {% for c in post.comments.all|slice:":3" %}
                            <div class="comment-item">
                                <span class="comment-author">{{ c.author.username }}</span>
                                <span class="comment-text">{{ c.content }}</span>
                            </div>
                            {% empty %}
                            <div class="comment-empty">ëŒ“ê¸€ì´ ì•„ì§ ì—†ì–´ìš”.</div>
                            {% endfor %}

                            {% if post.comment_count > 3 %}
                            <div class="comment-more">
                                <a class="link" href="{% url 'comments:post_comments' post.id %}">
                                ëŒ“ê¸€ {{ post.comment_count }}ê°œ ëª¨ë‘ ë³´ê¸°
                                </a>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div class="actions">
                    {% if user.is_authenticated %}
                        
                                <button
                                    type="button"
                                    class="btn like-btn {% if post.id in liked_post_ids %}liked{% endif %}"
                                    data-post-id="{{ post.id }}"
                                    data-like-url="{% url 'posts:like_toggle' post.id %}"
                                    aria-label="like"
                                    {% if not user.is_authenticated %}data-requires-auth="1"{% endif %}
                                >
                                    {% if post.id in liked_post_ids %}â¤ï¸{% else %}ğŸ¤{% endif %}
                                </button>
                                <a class="btn" href="{% url 'comments:post_comments' post.id %}" aria-label="comment">ğŸ’¬</a>
                    {% else %}
                        <button type="button" class="btn" disabled title="ë¡œê·¸ì¸ í›„ ê°€ëŠ¥">ğŸ¤</button>
                        <a class="btn" href="{% url 'accounts:login' %}" title="ë¡œê·¸ì¸ í›„ ê°€ëŠ¥">ğŸ’¬</a>
                    {% endif %}
                </div>

                </div>
            </article>
        {% empty %}
            <p>ì•„ì§ ê²Œì‹œê¸€ì´ ì—†ì–´ìš”. ìƒˆ ê²Œì‹œê¸€ì„ ì˜¬ë ¤ë³´ì!</p>
        {% endfor %}

    </div>
    
</div>

{% endblock %}
